<h1>Orders List</h1>

<% if current_member.admin %>
Past orders are used to estimate demand and generate reports, so please don't delete them :).<br><br>
<% end %>

<table>
  <tr>
    <th>Member</th>
    <th>Date Placed</th>
    <th>Planned Pickup</th>
    <th>Paid</th>
    <th>Taken</th>
    <th>Cost</th>
    <th>Notes</th>
    <th></th>
    <th></th>
  </tr>

<% @orders.each do |order| %>
  <tr>
    <td><%= order.member.name %></td>
    <td><%= order.created_at.strftime('%Y-%m-%d') %></td>
    <td><%= order.pickup_on.nil? ? "Not specified" : order.pickup_on.strftime('%A %b %d') %></td>
    <td><% if current_member.admin? %>
      <div style="text-align: center;">
      <a href="/orders/<%= order.id %>/toggle_paid?paypal=0"><%= image_tag("/images/check_" + (order.paid ? "on" : "off") + ".s.png",:border=>0) %></a>
      <a href="/orders/<%= order.id %>/toggle_paid?paypal=1"><%= image_tag("/images/pp_check_" + (order.paid_with_paypal ? "on" : "off") + ".s.png",:border=>0) %></a>
      </div>
    <% end %>
   </td>
    <td>
    <div style="text-align: center;">
    <% if current_member.admin? %>
      <a href="/orders/<%= order.id %>/toggle_taken"><%= image_tag("/images/check_" + (order.taken ? "on" : "off") + ".s.png",:border=>0) %></a>
    <% end %>
    </div>
    </td>
    <td><%= sprintf('$%.02f',order.cost) %></td>
    <td><%= word_wrap(order.notes,20).gsub("\n","<br>").html_safe unless order.notes.nil? %></td>
    <td><%= link_to image_tag("/images/view_button.s.png",:border=>0), order %><br>
        <%= link_to image_tag("/images/edit_button.s.png",:border=>0), edit_order_path(order) %><br>
        <%= link_to image_tag("/images/nix_button.s.png",:border=>0), order, :confirm => 'Are you sure?', :method => :delete %><br>
    </td>
    <% if current_member.admin or (!order.paid and !order.taken) %>
    <td>
     <% unless order.paid %>
     <form action="https://www.paypal.com/cgi-bin/webscr" method="post" target="_top">
        <input type="hidden" name="cmd" value="_s-xclick">
        <input type="hidden" name="encrypted" value="-----BEGIN PKCS7-----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-----END PKCS7-----
">
        <input type="image" src="https://www.paypalobjects.com/en_US/i/btn/btn_buynowCC_LG.gif" border="0" name="submit" alt="PayPal - The safer, easier way to pay online!">
        <img alt="" border="0" src="https://www.paypalobjects.com/en_US/i/scr/pixel.gif" width="1" height="1">
      </form>
      <div style="text-align: center; font-size: 8pt;">(<%= sprintf("$%.02f",order.paypal_cost) %> w/fees)</div>
     <% end %>
    <% else %>
    <td colspan=3>
    <% end %>
  </tr>
<% end %>
</table>
